{{ 'template-collection.css' | asset_url | stylesheet_tag }}
{{ 'component-loading-overlay.css' | asset_url | stylesheet_tag }}
{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{{ 'component-product-grid.css' | asset_url | stylesheet_tag }}

<link
  rel="preload"
  href="{{ 'component-rte.css' | asset_url }}"
  as="style"
  onload="this.onload=null;this.rel='stylesheet'"
>

<noscript>{{ 'component-rte.css' | asset_url | stylesheet_tag }}</noscript>
<script src="{{ 'collection-filters-form.js' | asset_url }}" defer="defer"></script>

<!-- Assign maxPages using Liquid -->
{% assign maxPages = paginate.pages %}
<!-- Debugging Output -->
<script>
  window.maxPages = {{ paginate.pages }};
  console.log('maxPages (Liquid):', {{ paginate.pages }});  // Debugging: Ensure this prints correctly
</script>

<script src="{{ 'infinite-scroll.js' | asset_url }}" defer="defer"></script>

{%- assign sort_by = collection.sort_by | default: collection.default_sort_by -%}

<div class="page-width-desktop collection-filters" id="main-collection-filters" data-id="{{ section.id }}">
  <div class="collection-wrapper{% if section.settings.filter_type == "vertical" %} vertical{% elsif section.settings.filter_type == "horizontal" %} horizontal{% endif %}">
    <div class="filter-top__container flex-space-center small-hide">
      <div class="filters-button__applied flex-space-cente">
        <filter-drawer-button class="filter-drawer__button unstyled-button h4">
          <span>
            <span class="filter-text">{{ 'sections.collection_template.show' | t }}</span>
            <span>{{ 'sections.collection_template.filters' | t }}</span>
          </span>
          <span class="filter-icon">{% render 'icon-collection-filter' %}</span>

          {% if section.settings.filter_type == 'vertical' %}
            {% render 'filters-applied' %}
          {% endif %}
        </filter-drawer-button>
      </div>
      <div class="product-count__sort">
        <div class="product-count h4">
          <span id="CollectionProductCountDesktop">
            {{- collection.all_products_count }}
            {{ 'sections.collection_template.products' | t -}}
          </span>
        </div>
        <div class="product-sort">
          {%- if section.settings.enable_sorting -%}
            <div class="collection-filters__item sorting caption">
              <div class="collection-filters__field">
                <label class="collection-filters__label caption-large" for="SortBy-duplicate">
                  {{ 'sections.collection_template.sort_by_label' | t | replace: ':', '' }}
                </label>
                <div class="select-wrapper">
                  {%- assign sort_by = collection.sort_by | default: collection.default_sort_by -%}
                  <select
                    name="sort_by"
                    class="collection-filters__sort select__select caption-large sort-by-duplicate"
                    id="SortBy-duplicate"
                    aria-describedby="a11y-refresh-page-message"
                  >
                    {%- for option in collection.sort_options -%}
                      <option
                        value="{{ option.value | escape }}"
                        {% if option.value == sort_by %}
                          selected="selected"
                        {% endif %}
                      >
                        {{ option.name | escape }}
                      </option>
                    {%- endfor -%}
                  </select>
                  {% render 'icon-caret' %}
                </div>
              </div>
              <noscript>
                <button
                  type="submit"
                  class="facets__button-no-js button"
                >
                  {{ 'sections.collection_template.sort_button' | t }}
                </button>
              </noscript>
            </div>
          {%- endif -%}
        </div>
      </div>
    </div>

    {% assign open_detail = false %}
    {% if section.settings.filter_type == 'vertical' %}
      {% assign open_detail = true %}
    {% endif %}
    <div class="{% if section.settings.filter_type == "vertical" %}col_filter_new-container vertical-filter{% elsif section.settings.filter_type == "horizontal" %} horizontal-filter{% endif %}">
      {%- if section.settings.enable_filtering or section.settings.enable_sorting -%}
        {%- assign total_active_values = 0 -%}
        {%- unless section.settings.collapse_on_larger_devices -%}
          <collection-filters-form class="facets{% if section.settings.filter_type == "vertical" %} col_filter_new hidden{% endif %} small-hide">
            <form id="CollectionFiltersForm" class="facets__form">
              {% if section.settings.enable_filtering %}
                <div class="facets__wrapper">
                  {%- for filter in collection.filters -%}
                    {%- assign total_active_values = total_active_values | plus: filter.active_values.size -%}
                    {% case filter.type %}
                      {% when 'list' %}
                        {%- if filter.label == 'Color'
                          or filter.label == 'Colour'
                          or filter.label == 'color'
                          or filter.label == 'colour'
                        -%}
                          <details
                            class="facets__disclosure js-filter"
                            data-index="{{ forloop.index }}"
                            {% if open_detail %}
                              open
                            {% endif %}
                          >
                            <summary class="facets__summary caption-large">
                              <div>
                                <span class="h4">{{ filter.label | escape }}</span>
                                {% render 'icon-caret' %}
                              </div>
                            </summary>
                            <div class="{% if section.settings.filter_type == "horizontal" %}facets__display{% endif %}">
                              <ul class="facets__list facets-color__list list-unstyled" role="list">
                                {%- for value in filter.values -%}
                                  <li class="list-menu__item facets__item">
                                    <label
                                      for="Filter-{{ filter.label | escape }}-{{ forloop.index }}"
                                      class="facet-checkbox{% if value.count == 0 and value.active == false %} facet-checkbox--disabled{% endif %}"
                                    >
                                      <input
                                        type="checkbox"
                                        name="{{ value.param_name }}"
                                        value="{{ value.value }}"
                                        id="Filter-{{ filter.label | escape }}-{{ forloop.index }}"
                                        {% if value.active %}
                                          checked
                                        {% endif %}
                                        {% if value.count == 0 and value.active == false %}
                                          disabled
                                        {% endif %}
                                      >
                                      {% assign present_color = value.label | handleize %}
                                      <span class="filter-color-checkbox no-line-height">
                                        <span
                                          class="color-span ab-center-center color-{{- present_color }} no-line-height"
                                        ></span>
                                      </span>
                                    </label>
                                  </li>
                                {%- endfor -%}
                              </ul>
                            </div>
                          </details>
                        {%- else -%}
                          <details
                            class="facets__disclosure js-filter"
                            data-index="{{ forloop.index }}"
                            {% if open_detail %}
                              open
                            {% endif %}
                          >
                            <summary class="facets__summary caption-large">
                              <div>
                                <span class="h4">{{ filter.label | escape }}</span>
                                {% render 'icon-caret' %}
                              </div>
                            </summary>
                            <div class="{% if section.settings.filter_type == "horizontal" %}facets__display{% endif %}">
                              <ul class="facets__list list-unstyled" role="list">
                                {%- for value in filter.values -%}
                                  <li class="list-menu__item facets__item">
                                    <label
                                      for="Filter-{{ filter.label | escape }}-{{ forloop.index }}"
                                      class="facet-checkbox{% if value.count == 0 and value.active == false %} facet-checkbox--disabled{% endif %}"
                                    >
                                      <input
                                        type="checkbox"
                                        name="{{ value.param_name }}"
                                        value="{{ value.value }}"
                                        id="Filter-{{ filter.label | escape }}-{{ forloop.index }}"
                                        {% if value.active %}
                                          checked
                                        {% endif %}
                                        {% if value.count == 0 and value.active == false %}
                                          disabled
                                        {% endif %}
                                      >
                                      <span class="filter-checkbox">
                                        <svg
                                          class="tick-mark ab-center-center"
                                          xmlns="http://www.w3.org/2000/svg"
                                          width="12"
                                          height="10"
                                          viewBox="0 0 12 10"
                                          fill="none"
                                        >
                                          <path d="M1.3125 5.99609L3.22656 8.7125C3.29917 8.82095 3.39662 8.9105 3.51082 8.97368C3.62501 9.03686 3.75265 9.07186 3.8831 9.07576C4.01355 9.07966 4.14305 9.05234 4.26082 8.99609C4.37858 8.93983 4.48121 8.85627 4.56016 8.75234L10.6875 1" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                      </span>

                                      <span>{{ value.label | escape }} ({{ value.count }})</span>
                                    </label>
                                  </li>
                                {%- endfor -%}
                              </ul>
                            </div>
                          </details>
                        {%- endif -%}
                      {% when 'price_range' %}
                        {% liquid
                          assign currencies_using_comma_decimals = 'ANG,ARS,BRL,BYN,BYR,CLF,CLP,COP,CRC,CZK,DKK,EUR,HRK,HUF,IDR,ISK,MZN,NOK,PLN,RON,RUB,SEK,TRY,UYU,VES,VND' | split: ','
                          assign uses_comma_decimals = false
                          if currencies_using_comma_decimals contains cart.currency.iso_code
                            assign uses_comma_decimals = true
                          endif
                        %}
                        <details
                          class="facets__disclosure js-filter"
                          data-index="{{ forloop.index }}"
                          {% if open_detail %}
                            open
                          {% endif %}
                        >
                          <summary class="facets__summary caption-large">
                            <div>
                              <span class="h4">{{ filter.label | escape }}</span>
                              {% render 'icon-caret' %}
                            </div>
                          </summary>
                          <div class="{% if section.settings.filter_type == "horizontal" %}facets__display{% endif %}">
                            <price-range class="facets__price">
                              <div class="field">
                                <input
                                  class="field__input field__input--min"
                                  name="{{ filter.min_value.param_name }}"
                                  id="Filter-{{ filter.label | escape }}-GTE"
                                  {%- if filter.range_min -%}
                                    {%- if uses_comma_decimals -%}
                                      value="{{ filter.range_min | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
                                    {%- else -%}
                                      value="{{ filter.range_min | money_without_currency | replace: ',', '' }}"
                                    {%- endif %}
                                  {%- endif -%}
                                  type="number"
                                  placeholder="0"
                                  min="0"
                                  {%- if uses_comma_decimals -%}
                                    max="{{ filter.range_max | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
                                  {%- else -%}
                                    max="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                                  {% endif %}
                                >
                                <label class="field__label" for="Filter-{{ filter.label | escape }}-GTE">
                                  <span class="field-currency">{{ cart.currency.symbol }}</span>
                                </label>
                              </div>

                              <div class="field">
                                <input
                                  class="field__input field__input--max"
                                  name="{{ filter.max_value.param_name }}"
                                  id="Filter-{{ filter.label | escape }}-LTE"
                                  {%- if filter.range_max -%}
                                    {%- if uses_comma_decimals -%}
                                      value="{{ filter.range_max | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
                                    {%- else -%}
                                      value="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                                    {%- endif %}
                                  {%- endif -%}
                                  type="number"
                                  min="0"
                                  {%- if uses_comma_decimals -%}
                                    placeholder="{{ filter.range_max | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
                                    max="{{ filter.range_max | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
                                  {%- else -%}
                                    placeholder="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                                    max="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                                  {% endif %}
                                >
                                <label class="field__label" for="Filter-{{ filter.label | escape }}-LTE">
                                  <span class="field-currency">{{ cart.currency.symbol }}</span>
                                </label>
                              </div>
                            </price-range>
                          </div>
                        </details>
                    {% endcase %}
                  {%- endfor -%}
                  <noscript>
                    <button type="submit" class="facets__button-no-js button">
                      {{ 'sections.collection_template.filter_button' | t }}
                    </button>
                  </noscript>
                </div>
              {% endif %}

              {% if collection.current_vendor or collection.current_type %}
                <input type="hidden" name="q" value="{{ collection.current_vendor }}{{ collection.current_type }}">
              {% endif %}

              <div class="flex-space-center">
                <div class="collection-filters__item">
                  <p class="collection-product-count light" role="status">
                    {%- if collection.products_count == collection.all_products_count -%}
                      {{ collection.all_products_count }}
                    {%- else -%}
                      {{ collection.all_products_count }}
                    {%- endif -%}
                    <span class="product-title">{{ 'sections.collection_template.products' | t }}</span>
                  </p>
                </div>
                {%- if section.settings.enable_sorting -%}
                  <div class="collection-filters__item sorting caption">
                    <div class="collection-filters__field">
                      <label class="collection-filters__label caption-large" for="SortBy">
                        {{- 'sections.collection_template.sort_by_label' | t -}}
                      </label>
                      <div class="select-wrapper">
                        {%- assign sort_by = collection.sort_by | default: collection.default_sort_by -%}
                        <select
                          name="sort_by"
                          class="collection-filters__sort select__select caption-large sort-by-duplicate"
                          id="SortBy"
                          aria-describedby="a11y-refresh-page-message"
                        >
                          {%- for option in collection.sort_options -%}
                            <option
                              value="{{ option.value | escape }}"
                              {% if option.value == sort_by %}
                                selected="selected"
                              {% endif %}
                            >
                              {{ option.name | escape }}
                            </option>
                          {%- endfor -%}
                        </select>
                        {% render 'icon-caret' %}
                      </div>
                    </div>
                    <noscript>
                      <button type="submit" class="facets__button-no-js button">
                        {{ 'sections.collection_template.sort_button' | t }}
                      </button>
                    </noscript>
                  </div>
                {%- endif -%}
              </div>
            </form>
          </collection-filters-form>
          {% if section.settings.filter_type == 'horizontal' %}
            {% render 'filters-applied' %}
          {% endif %}
        {%- endunless -%}

        <div class="active-facets active-facets-mobile {% unless section.settings.collapse_on_larger_devices %} medium-hide large-up-hide{% endunless %}">
          {%- assign has_active_filter = false -%}
          {%- for filter in collection.filters -%}
            {%- for value in filter.active_values -%}
              {%- assign has_active_filter = true -%}
              <facet-remove>
                <a href="{{ value.url_to_remove }}" class="active-facets__button active-facets__button--light">
                  <span
                    class="
                      active-facets__button-inner
                      h4
                    "
                  >
                    {{ value.label | escape }}
                    {% render 'icon-close-small' %}
                  </span>
                </a>
              </facet-remove>
            {%- endfor -%}
            {%- if filter.type == 'price_range' -%}
              {%- if filter.min_value.value != null or filter.max_value.value != null -%}
                {%- assign has_active_filter = true -%}
                <facet-remove>
                  <a href="{{ filter.url_to_remove }}" class="active-facets__button active-facets__button--light">
                    <span class="active-facets__button-inner h4">
                      {%- if filter.min_value.value -%}
                        {{ filter.min_value.value | money }}
                      {%- else -%}
                        {{ 0 | money }}
                      {%- endif -%}
                      -
                      {%- if filter.max_value.value -%}
                        {{ filter.max_value.value | money }}
                      {%- else -%}
                        {{ filter.range_max | money }}
                      {%- endif -%}
                      {% render 'icon-close-small' %}
                    </span>
                  </a>
                </facet-remove>
              {%- endif -%}
            {%- endif -%}
          {%- endfor -%}
          {%- if has_active_filter -%}
            <facet-remove class="active-facets__button-wrapper h4">
              <a href="{{ collection.url }}?sort_by={{ sort_by }}" class="underlined-link base-text-color">
                <span>{{ 'sections.collection_template.remove_all' | t }}</span>
              </a>
            </facet-remove>
          {%- endif -%}
        </div>
        <div class="filters-text-container">
          <menu-drawer
            class="mobile-facets__wrapper {% unless section.settings.collapse_on_larger_devices %} medium-hide large-up-hide{% endunless %}"
            data-breakpoint="mobile"
          >
            <details class="mobile-facets__disclosure disclosure-has-popup">
              <summary class="mobile-facets__open-wrapper">
                <span class="mobile-facets__open h4">
                  <span class="mobile-facets__open-label button-label">
                    {{- 'sections.collection_template.filter_and_sort' | t -}}
                  </span>
                  {% render 'icon-collection-filter' %}
                </span>
                <span tabindex="0" class="mobile-facets__close mobile-facets__close--no-js">
                  {%- render 'icon-close' -%}
                </span>
              </summary>
              <collection-filters-form>
                <form id="CollectionFiltersFormMobile" class="mobile-facets">
                  <div class="mobile-facets__inner">
                    <div class="mobile-facets__header">
                      <div class="mobile-facets__header-inner">
                        <h2 class="mobile-facets__heading">{{ 'sections.collection_template.filter_and_sort' | t }}</h2>
                        <p class="mobile-facets__count">
                          {{
                            'sections.collection_template.product_count'
                            | t: product_count: collection.products_count, count: collection.all_products_count
                          }}
                        </p>
                      </div>
                    </div>
                    <div class="mobile-facets__main">
                      {%- for filter in collection.filters -%}
                        {% case filter.type %}
                          {% when 'list' %}
                            {%- if filter.label == 'Color'
                              or filter.label == 'Colour'
                              or filter.label == 'color'
                              or filter.label == 'colour'
                            -%}
                              <details class="mobile-facets__details js-filter" data-index="mobile-{{ forloop.index }}">
                                <summary class="mobile-facets__summary h4">
                                  <div>
                                    <span>{{ filter.label | escape }}</span>
                                    <span class="mobile-facets__arrow no-js-hidden">{% render 'icon-caret' %}</span>
                                    <noscript>{% render 'icon-caret' %}</noscript>
                                  </div>
                                </summary>
                                <div class="mobile-facets__list-container">
                                  <ul
                                    class="mobile-facets__list facets__list list-unstyled facets-color__list"
                                    role="list"
                                  >
                                    {%- for value in filter.values -%}
                                      <li class="mobile-facets__item list-menu__item">
                                        <label
                                          for="Filter-{{ filter.label | escape }}-mobile-{{ forloop.index }}"
                                          class="facet-checkbox mobile-facets__label{% if value.count == 0 and value.active == false %} mobile-facets__label--disabled{% endif %}"
                                        >
                                          <input
                                            class="mobile-facets__checkbox"
                                            type="checkbox"
                                            name="{{ value.param_name }}"
                                            value="{{ value.value }}"
                                            id="Filter-{{ filter.label | escape }}-mobile-{{ forloop.index }}"
                                            {% if value.active %}
                                              checked
                                            {% endif %}
                                            {% if value.count == 0 and value.active == false %}
                                              disabled
                                            {% endif %}
                                          >

                                          {% assign present_color = value.label | handleize %}
                                          <span class="filter-color-checkbox no-line-height">
                                            <span
                                              class="color-span ab-center-center color-{{- present_color }} no-line-height"
                                            ></span>
                                          </span>
                                        </label>
                                      </li>
                                    {%- endfor -%}
                                  </ul>
                                </div>
                              </details>
                            {%- else -%}
                              <details class="mobile-facets__details js-filter" data-index="mobile-{{ forloop.index }}">
                                <summary class="mobile-facets__summary h4">
                                  <div>
                                    <span>{{ filter.label | escape }}</span>
                                    <span class="mobile-facets__arrow no-js-hidden">{% render 'icon-caret' %}</span>
                                    <noscript>{% render 'icon-caret' %}</noscript>
                                  </div>
                                </summary>
                                <div class="mobile-facets__list-container">
                                  <ul class="mobile-facets__list facets__list list-unstyled" role="list">
                                    {%- for value in filter.values -%}
                                      <li class="mobile-facets__item list-menu__item">
                                        <label
                                          for="Filter-{{ filter.label | escape }}-mobile-{{ forloop.index }}"
                                          class="facet-checkbox mobile-facets__label{% if value.count == 0 and value.active == false %} mobile-facets__label--disabled{% endif %}"
                                        >
                                          <input
                                            class="mobile-facets__checkbox"
                                            type="checkbox"
                                            name="{{ value.param_name }}"
                                            value="{{ value.value }}"
                                            id="Filter-{{ filter.label | escape }}-mobile-{{ forloop.index }}"
                                            {% if value.active %}
                                              checked
                                            {% endif %}
                                            {% if value.count == 0 and value.active == false %}
                                              disabled
                                            {% endif %}
                                          >
                                          <span class="filter-checkbox">
                                            <svg
                                              class="tick-mark ab-center-center"
                                              xmlns="http://www.w3.org/2000/svg"
                                              width="12"
                                              height="10"
                                              viewBox="0 0 12 10"
                                              fill="none"
                                            >
                                              <path d="M1.3125 5.99609L3.22656 8.7125C3.29917 8.82095 3.39662 8.9105 3.51082 8.97368C3.62501 9.03686 3.75265 9.07186 3.8831 9.07576C4.01355 9.07966 4.14305 9.05234 4.26082 8.99609C4.37858 8.93983 4.48121 8.85627 4.56016 8.75234L10.6875 1" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                          </span>
                                          <span>{{ value.label | escape }} ({{ value.count }})</span>
                                        </label>
                                      </li>
                                    {%- endfor -%}
                                  </ul>
                                </div>
                              </details>
                            {%- endif -%}
                          {% when 'price_range' %}
                            <details class="mobile-facets__details js-filter" data-index="mobile-{{ forloop.index }}">
                              <summary class="mobile-facets__summary h4">
                                <div>
                                  <span>{{ filter.label | escape }}</span>
                                  <span class="mobile-facets__arrow no-js-hidden">{% render 'icon-caret' %}</span>
                                  <noscript>{% render 'icon-caret' %}</noscript>
                                </div>
                              </summary>
                              <div class="mobile-facets__list-container">
                                <price-range class="facets__price">
                                  <div class="field">
                                    <input
                                      class="field__input field__input--min"
                                      name="{{ filter.min_value.param_name }}"
                                      id="Filter-{{ filter.label | escape }}-GTE"
                                      {%- if filter.range_min -%}
                                        {%- if uses_comma_decimals -%}
                                          value="{{ filter.range_min | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
                                        {%- else -%}
                                          value="{{ filter.range_min | money_without_currency | replace: ',', '' }}"
                                        {%- endif %}
                                      {%- endif -%}
                                      type="number"
                                      placeholder="0"
                                      min="0"
                                      {%- if uses_comma_decimals -%}
                                        max="{{ filter.range_max | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
                                      {%- else -%}
                                        max="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                                      {% endif %}
                                    >
                                    <label class="field__label" for="Filter-{{ filter.label | escape }}-GTE">
                                      <span class="field-currency">{{ cart.currency.symbol }}</span>
                                    </label>
                                  </div>

                                  <div class="field">
                                    <input
                                      class="field__input field__input--max"
                                      name="{{ filter.max_value.param_name }}"
                                      id="Filter-{{ filter.label | escape }}-LTE"
                                      {%- if filter.range_max -%}
                                        {%- if uses_comma_decimals -%}
                                          value="{{ filter.range_max | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
                                        {%- else -%}
                                          value="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                                        {%- endif %}
                                      {%- endif -%}
                                      type="number"
                                      min="0"
                                      {%- if uses_comma_decimals -%}
                                        placeholder="{{ filter.range_max | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
                                        max="{{ filter.range_max | money_without_currency | replace: '.', '' | replace: ',', '.' }}"
                                      {%- else -%}
                                        placeholder="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                                        max="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                                      {% endif %}
                                    >
                                    <label class="field__label" for="Filter-{{ filter.label | escape }}-LTE">
                                      <span class="field-currency">{{ cart.currency.symbol }}</span>
                                    </label>
                                  </div>
                                </price-range>
                              </div>
                            </details>
                        {% endcase %}
                      {%- endfor -%}

                      {%- if section.settings.enable_sorting -%}
                        <div class="mobile-facets__details js-filter" data-index="mobile-{{ forloop.index }}">
                          <div class="mobile-facets__summary h4">
                            <div class="mobile-facets__sort">
                              <label class="mobile-sortBy" for="SortBy-mobile">
                                {{- 'sections.collection_template.sort_by_label' | t -}}
                              </label>
                              <div class="select">
                                <select
                                  name="sort_by"
                                  class="select__select"
                                  id="SortBy-mobile"
                                  aria-describedby="a11y-refresh-page-message"
                                >
                                  {%- for option in collection.sort_options -%}
                                    <option
                                      value="{{ option.value | escape }}"
                                      {% if option.value == sort_by %}
                                        selected="selected"
                                      {% endif %}
                                    >
                                      {{ option.name | escape }}
                                    </option>
                                  {%- endfor -%}
                                </select>
                                {% render 'icon-caret' %}
                              </div>
                            </div>
                          </div>
                        </div>
                      {%- endif -%}
                    </div>

                    <div class="mobile-facets__footer">
                      <facet-remove class="mobile-facets__clear-wrapper button button--secondary h4">
                        <a href="{{ collection.url }}" class="mobile-facets__clear">
                          {{- 'sections.collection_template.clear_all' | t -}}
                        </a>
                      </facet-remove>
                      <button
                        type="button"
                        class="no-js-hidden button button--primary"
                        onclick="this.closest('.mobile-facets__wrapper').querySelector('summary').click()"
                      >
                        {{ 'sections.collection_template.apply' | t }}
                      </button>
                      <noscript
                        ><button class="button button--primary">
                          {{ 'sections.collection_template.apply' | t }}
                        </button></noscript
                      >
                    </div>

                    {% if collection.current_vendor or collection.current_type %}
                      <input
                        type="hidden"
                        name="q"
                        value="{{ collection.current_vendor }}{{ collection.current_type }}"
                      >
                    {% endif %}
                  </div>
                </form>
              </collection-filters-form>
            </details>
          </menu-drawer>

          <div class="collection-productcount-container">
            <p
              id="CollectionProductCount"
              class="collection-product-count light{% unless section.settings.collapse_on_larger_devices %} medium-hide large-up-hide{% endunless %}"
              role="status"
            >
              <span>
                {%- if collection.products_count == collection.all_products_count -%}
                  {{ collection.all_products_count }}
                {%- else -%}
                  {{ collection.products_count }}
                {%- endif -%}
              </span>
              <span>{{ 'sections.collection_template.products' | t }}</span>
            </p>
          </div>
        </div>
      {%- endif -%}
      <div
        id="CollectionProductGrid"
        class="{% if section.settings.filter_type == "vertical" %} new_prd_grid{% endif %}"
      >
        {%- paginate collection.products by section.settings.products_per_page -%}
          {%- assign maxPages = paginate.pages -%}

          <!-- Define maxPages variable for use in infinite-scroll.js -->
          <script>
            window.maxPages = {{ maxPages }};
            console.log('maxPages (Liquid):', {{ maxPages }});  // Debugging: Ensure this prints correctly
          </script>

          <!-- Place the spinner once at the start, outside the conditionals -->
          <div class="infinite-scroll-loading-overlay hidden">
            <div class="infinite-scroll-loading-overlay__spinner">
              <svg
                aria-hidden="true"
                focusable="false"
                role="presentation"
                class="spinner"
                viewBox="0 0 66 66"
                xmlns="http://www.w3.org/2000/svg"
              >
                <circle class="path" fill="none" stroke-width="6" cx="33" cy="33" r="30"></circle>
              </svg>
            </div>
          </div>

          {%- if collection.products.size == 0 -%}
            <div
              class="collection collection--empty page-width-desktop"
              id="main-collection-product-grid"
              data-id="{{ section.id }}"
            >
              <p class="collection-product-count light" role="status">
                {%- if collection.products_count == collection.all_products_count -%}
                  {{ 'sections.collection_template.product_count_simple' | t: count: collection.products_count }}
                {%- else -%}
                  {{
                    'sections.collection_template.product_count'
                    | t: product_count: collection.products_count, count: collection.all_products_count
                  }}
                {%- endif -%}
              </p>
              <div class="title-wrapper center">
                <h2 class="title title--primary">
                  {{ 'sections.collection_template.empty' | t -}}
                  <br>
                  {{
                    'sections.collection_template.use_fewer_filters_html'
                    | t: link: collection.url, class: 'underlined-link link'
                  }}
                </h2>
              </div>
            </div>
          {%- else -%}
            <div class="collection">
              <ul
                id="main-collection-product-grid"
                data-id="{{ section.id }}"
                class="grid grid--2-col negative-margin product-grid grid--3-col-desktop"
              >
                {%- for product in collection.products -%}
                  <li class="grid__item">
                    {% render 'product-card',
                      product_card_product: product,
                      media_size: section.settings.image_ratio,
                      show_secondary_image: section.settings.show_secondary_image,
                      add_image_padding: section.settings.add_image_padding,
                      show_vendor: section.settings.show_vendor,
                      show_image_outline: section.settings.show_image_outline
                    %}
                  </li>
                {%- endfor -%}
              </ul>

              {%- if paginate.pages > 1 -%}
                <div class="pagination">
                  {% render 'pagination', paginate: paginate, anchor: '' %}
                  {%- if paginate.next -%}
                    <span class="pagination-next">
                      <a href="{{ paginate.next.url }}" aria-hidden="true">Next</a>
                    </span>
                  {%- endif -%}
                </div>
              {%- endif -%}
            </div>
          {%- endif -%}
        {%- endpaginate -%}
      </div>
    </div>
  </div>
</div>

{%- if section.settings.enable_filtering == false -%}
  <style>
    .facets__form {
      display: flex;
      justify-content: space-between;
    }
  </style>
{%- endif -%}

{%- if section.settings.enable_sorting == false -%}
  <style>
    .facets__form {
      gap: 0;
    }
  </style>
{%- endif -%}

{%- if section.settings.collapse_on_larger_devices -%}
  <style>
    .collection-productcount-container {
      display: inline-block;
      justify-content: flex-end;
    }
  </style>
{%- endif -%}

<style>
  .collection-filters {
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
  }
</style>

{%- if section.settings.filter_type == 'vertical' -%}
  {%- if section.settings.collapse_on_larger_devices == false -%}
    {%- if collection.products.size != 0 -%}
      <style>
        @media screen and (min-width: 990px) {
          .col_filter_new-container {
            display: flex;
          }
          .filters-text-container {
            display: inline-block;
          }
        }
      </style>
    {%- endif -%}
  {%- endif -%}
{%- endif -%}

{% schema %}
{
  "name": "t:sections.main-collection-product-grid.name",
  "class": "spaced-section collection-grid-section",
  "settings": [
    {
      "type": "range",
      "id": "products_per_page",
      "min": 8,
      "max": 24,
      "step": 4,
      "default": 16,
      "label": "t:sections.main-collection-product-grid.settings.products_per_page.label"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 36
    },
    {
      "type": "header",
      "content": "t:sections.main-collection-product-grid.settings.header__1.content"
    },
    {
      "type": "select",
      "id": "filter_type",
      "options": [
        {
          "value": "vertical",
          "label": "Vertical filter"
        },
        {
          "value": "horizontal",
          "label": "Horizontal filter"
        }
      ],
      "default": "vertical",
      "label": "Filter Design"
    },
    {
      "type": "checkbox",
      "id": "enable_filtering",
      "default": true,
      "label": "t:sections.main-collection-product-grid.settings.enable_filtering.label",
      "info": "t:sections.main-collection-product-grid.settings.enable_filtering.info"
    },
    {
      "type": "checkbox",
      "id": "enable_sorting",
      "default": true,
      "label": "t:sections.main-collection-product-grid.settings.enable_sorting.label"
    },
    {
      "type": "checkbox",
      "id": "collapse_on_larger_devices",
      "default": false,
      "label": "t:sections.main-collection-product-grid.settings.collapse_on_larger_devices.label"
    }
  ]
}
{% endschema %}
